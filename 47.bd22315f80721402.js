"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[47],{5047:(C,g,n)=>{n.r(g),n.d(g,{default:()=>M});var k=n(177),l=n(9417),T=n(4796),e=n(4438),h=n(9211),u=n(2656),b=n(3062),y=n(7471);function f(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",10)(1,"h3",11),e.EFF(2),e.k0s(),e.j41(3,"div",12)(4,"button",13),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.enterTaskType(s))}),e.EFF(5," INGRESAR "),e.k0s(),e.j41(6,"button",14),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.openEditModal(s))}),e.j41(7,"span",15),e.EFF(8,"edit"),e.k0s()(),e.j41(9,"button",16),e.bIt("click",function(){const s=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.openDeleteModal(s))}),e.j41(10,"span",17),e.EFF(11,"delete"),e.k0s()()()()}if(2&a){const t=d.$implicit;e.R7$(2),e.JRh(t.nombre)}}function x(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",20)(1,"div")(2,"p",21),e.EFF(3),e.k0s(),e.j41(4,"p",22),e.EFF(5),e.k0s(),e.j41(6,"p",23)(7,"strong"),e.EFF(8,"Nota:"),e.k0s(),e.EFF(9),e.k0s()(),e.j41(10,"div",24)(11,"select",25),e.mxI("ngModelChange",function(s){const i=e.eBV(t).$implicit;return e.DH7(i.estado,s)||(i.estado=s),e.Njj(s)}),e.bIt("change",function(){const s=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.changeTodayTaskStatus(s))}),e.j41(12,"option",26),e.EFF(13,"Pendiente"),e.k0s(),e.j41(14,"option",27),e.EFF(15,"Realizado"),e.k0s(),e.j41(16,"option",28),e.EFF(17,"No realizado"),e.k0s(),e.j41(18,"option",29),e.EFF(19,"Para hoy"),e.k0s()()()()}if(2&a){const t=d.$implicit,o=e.XpG(2);e.R7$(3),e.SpI(" ",o.todayTaskOrigins.get(t.nombre)||"-"," "),e.R7$(2),e.JRh(t.nombre),e.R7$(4),e.SpI(" ",t.nota||"-"," "),e.R7$(2),e.R50("ngModel",t.estado),e.Y8G("ngClass",o.getEstadoColor(t))}}function v(a,d){if(1&a&&(e.j41(0,"div",18),e.DNE(1,x,20,5,"div",19),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.todayTasks)}}function E(a,d){1&a&&(e.j41(0,"div",30),e.EFF(1," No hay tareas programadas para hoy. "),e.k0s())}function j(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",31)(1,"div",32)(2,"h2",33),e.EFF(3,"Nuevo Tipo de Tarea"),e.k0s(),e.j41(4,"label",34),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",35),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.newTaskType,s)||(i.newTaskType=s),e.Njj(s)}),e.k0s(),e.j41(7,"div",36)(8,"button",37),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.closeModal())}),e.EFF(9," Cancelar "),e.k0s(),e.j41(10,"button",38),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.addTaskType())}),e.EFF(11," Agregar "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newTaskType)}}function F(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",39)(1,"div",32)(2,"h2",33),e.EFF(3,"Editar Tipo de Tarea"),e.k0s(),e.j41(4,"p",40),e.EFF(5,"Modifica el nombre del tipo de tarea."),e.k0s(),e.j41(6,"label",41),e.EFF(7,"Nuevo Nombre:"),e.k0s(),e.j41(8,"input",42),e.mxI("ngModelChange",function(s){e.eBV(t);const i=e.XpG();return e.DH7(i.editedTaskType,s)||(i.editedTaskType=s),e.Njj(s)}),e.k0s(),e.j41(9,"div",36)(10,"button",43),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.closeEditModal())}),e.EFF(11," Cancelar "),e.k0s(),e.j41(12,"button",38),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.saveTaskTypeEdit())}),e.EFF(13," Guardar "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.editedTaskType)}}function w(a,d){if(1&a){const t=e.RV6();e.j41(0,"div",39)(1,"div",44)(2,"span",45),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",46),e.EFF(5,"\xbfEliminar Tipo de Tarea?"),e.k0s(),e.j41(6,"p",47),e.EFF(7," \xbfEst\xe1s seguro de eliminar este tipo de tarea? Esta acci\xf3n no se puede deshacer. "),e.k0s(),e.j41(8,"div",48)(9,"button",49),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.closeDeleteModal())}),e.EFF(10," Cancelar "),e.k0s(),e.j41(11,"button",50),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.confirmDeleteTaskType())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let M=(()=>{class a{constructor(t,o,s,i){this.taskTypeService=t,this.taskService=o,this.dateService=s,this.router=i,this.authService=(0,e.WQX)(T.u),this.taskTypes=[],this.isModalOpen=!1,this.newTaskType="",this.isEditModalOpen=!1,this.taskTypeToEdit="",this.editedTaskType="",this.isDeleteModalOpen=!1,this.taskTypeToDelete="",this.todayTasks=[],this.todayTaskOrigins=new Map}ngOnInit(){this.loadTaskTypes(),this.loadTodayTasks(),this.dateService.selectedDate$.subscribe(()=>{this.loadTaskTypes(),this.loadTodayTasks()}),this.dateService.selectedDate$.subscribe(t=>{console.log("[OBS] Fecha detectada:",t),this.loadTaskTypes(),this.loadTodayTasks()}),this.authService.startAutoLogout()}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadTaskTypes(){this.taskTypeService.getAllTaskTypes().subscribe({next:t=>{console.log("[GET] Tipos cargados:",t),this.taskTypes=t},error:t=>{console.error("[ERROR] Al obtener tipos de tarea:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newTaskType=""}addTaskType(){this.newTaskType.trim()&&this.taskTypeService.addTaskType(this.newTaskType).subscribe({next:()=>{this.loadTaskTypes(),this.closeModal()},error:t=>{console.error("[ERROR] Al agregar tipo:",t)}})}enterTaskType(t){console.log("[NAVIGATE TO]",t),this.router.navigate(["/app/category",t.key])}openEditModal(t){this.taskTypeToEdit=t.key,this.editedTaskType=t.nombre,this.isEditModalOpen=!0}closeEditModal(){this.isEditModalOpen=!1,this.editedTaskType="",this.taskTypeToEdit=""}saveTaskTypeEdit(){this.editedTaskType.trim()&&this.taskTypeToEdit&&this.taskTypeService.editTaskType(this.taskTypeToEdit,this.editedTaskType).subscribe({next:()=>{this.loadTaskTypes(),this.closeEditModal()},error:t=>console.error("[ERROR] Al editar tipo:",t)})}openDeleteModal(t){this.taskTypeToDelete=t.key,this.isDeleteModalOpen=!0}closeDeleteModal(){this.taskTypeToDelete="",this.isDeleteModalOpen=!1}confirmDeleteTaskType(){this.taskTypeToDelete&&this.taskTypeService.deleteTaskType(this.taskTypeToDelete).subscribe({next:()=>{this.loadTaskTypes(),this.closeDeleteModal()},error:t=>console.error("[ERROR] Al eliminar tipo:",t)})}loadTodayTasks(){this.taskService.getAllTasks().subscribe({next:t=>{const o=new Date,s=new Date(o.getFullYear(),o.getMonth(),o.getDate()),R=t.map(r=>{if("realizado"===r.estado)return r;if(r.fecha){const[c,m,p]=r.fecha.split("-").map(Number),_=new Date(c,m-1,p);r.estado=_.getTime()===s.getTime()?"para hoy":_.getTime()<s.getTime()?"no realizado":"pendiente"}else r.estado="pendiente";return r}).filter(r=>{const[c,m,p]=r.fecha?.split("-")?.map(Number)||[],_=new Date(c,m-1,p);return"no realizado"===r.estado||r.fecha&&_.getTime()===s.getTime()});this.todayTasks=R.sort((r,c)=>"no realizado"===r.estado&&"no realizado"!==c.estado?-1:"no realizado"===c.estado&&"no realizado"!==r.estado?1:0),this.todayTaskOrigins.clear(),this.todayTasks.forEach(r=>{if(r.tipo){const m=r.tipo.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ");this.todayTaskOrigins.set(r.nombre,m)}})},error:t=>console.error("[ERROR] Al cargar tareas:",t)})}changeTodayTaskStatus(t){const o=t.nombre.trim().toLowerCase().replace(/\s+/g,"_"),s=t.tipo;s&&this.taskService.updateTask(s,o,t).subscribe({next:()=>console.log("[UPDATE] Estado actualizado desde resumen"),error:i=>console.error("[ERROR] Al actualizar estado desde resumen:",i)})}getEstadoColor(t){switch(t.estado){case"realizado":return"bg-teal-600 text-white";case"para hoy":return"bg-orange-600 text-white";case"no realizado":return"bg-red-600 text-white";default:return"bg-slate-500 text-white"}}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(h.z),e.rXU(u.R),e.rXU(b.k),e.rXU(y.Ix))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-home"]],standalone:!0,features:[e.aNF],decls:13,vars:6,consts:[[1,"p-6","w-full"],[1,"flex","flex-wrap","gap-4"],["class","bg-white dark:bg-slate-700 rounded-lg shadow-sm border border-gray-200 dark:border-slate-600 p-4 w-60 h-[150px] flex flex-col justify-between items-center transition-transform hover:-translate-y-1 hover:shadow-md",4,"ngFor","ngForOf"],[1,"bg-sky-600","hover:bg-sky-800","text-white","w-64","h-[150px]","rounded-lg","flex","items-center","justify-center","cursor-pointer","text-4xl","shadow-md","transition-transform","hover:-translate-y-1",3,"click"],[1,"bg-white","dark:bg-slate-700","rounded-xl","shadow","border","border-gray-200","dark:border-gray-600","p-6","mt-6","mx-auto","max-w-4xl"],[1,"text-xl","font-bold","text-sky-800","dark:text-white","mb-4"],["class","space-y-4",4,"ngIf"],["class","text-center text-gray-500 py-6",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-40",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",4,"ngIf"],[1,"bg-white","dark:bg-slate-700","rounded-lg","shadow-sm","border","border-gray-200","dark:border-slate-600","p-4","w-60","h-[150px]","flex","flex-col","justify-between","items-center","transition-transform","hover:-translate-y-1","hover:shadow-md"],[1,"text-lg","font-semibold","text-gray-800","dark:text-white"],[1,"flex","items-center","justify-between","w-full","gap-2"],[1,"bg-sky-600","text-white","py-1","px-3","rounded","hover:bg-sky-800","transition","flex-1","flex","items-center","justify-center","gap-1",3,"click"],[1,"hover:bg-sky-100","p-2","rounded-full","transition",3,"click"],[1,"material-icons","text-sky-600","dark:text-sky-400"],[1,"hover:bg-red-100","p-2","rounded-full","transition",3,"click"],[1,"material-icons","text-orange-600","dark:text-red-400"],[1,"space-y-4"],["class","flex flex-col sm:flex-row sm:items-center sm:justify-between bg-gray-50 dark:bg-slate-600 p-4 rounded-lg shadow-sm",4,"ngFor","ngForOf"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","bg-gray-50","dark:bg-slate-600","p-4","rounded-lg","shadow-sm"],[1,"text-base","font-bold","text-sky-800","dark:text-white"],[1,"font-semibold","text-sky-800","dark:text-white"],[1,"text-sm","text-gray-600","dark:text-gray-300"],[1,"mt-3","sm:mt-0","sm:ml-4"],[1,"text-sm","font-semibold","px-3","py-2","rounded-md","shadow-sm","border","w-full","sm:w-auto",3,"ngModelChange","change","ngModel","ngClass"],["value","pendiente",1,"text-black","bg-slate-100"],["value","realizado",1,"text-black","bg-slate-100"],["value","no realizado",1,"text-black","bg-slate-100"],["value","para hoy",1,"text-black","bg-slate-100"],[1,"text-center","text-gray-500","py-6"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-40","z-40"],[1,"bg-white","dark:bg-slate-800","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","text-sky-700","dark:text-white","mb-4"],[1,"block","mb-2","text-sm","text-gray-700","dark:text-gray-200"],["type","text",1,"w-full","p-2","border","rounded","mb-4","bg-white","dark:bg-slate-700","dark:text-white","dark:border-slate-600",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-slate-100","dark:hover:bg-slate-600",3,"click"],[1,"px-4","py-2","bg-sky-600","text-white","rounded-md","hover:bg-sky-700",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","z-50"],[1,"text-gray-600","dark:text-gray-300","mb-4","text-sm"],[1,"block","mb-2","text-sm","font-semibold","text-gray-700","dark:text-gray-200"],["type","text","placeholder","Ej: Universidad",1,"w-full","p-2","border","rounded-md","mb-4","bg-white","dark:bg-slate-700","dark:text-white","dark:border-slate-600",3,"ngModelChange","ngModel"],[1,"px-4","py-2","border","rounded-md","bg-white","hover:bg-slate-100","dark:bg-slate-700","dark:text-white","dark:border-slate-600","dark:hover:bg-slate-600",3,"click"],[1,"bg-white","dark:bg-slate-800","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","dark:text-red-400","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","text-red-700","dark:text-white","mt-4","mb-2"],[1,"mb-6","text-gray-700","dark:text-gray-300","text-sm"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-orange-100","dark:hover:bg-slate-600",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,f,12,1,"div",2),e.j41(3,"div",3),e.bIt("click",function(){return s.openModal()}),e.EFF(4," + "),e.k0s()()(),e.j41(5,"div",4)(6,"h2",5),e.EFF(7,"Resumen de Tareas"),e.k0s(),e.DNE(8,v,2,1,"div",6)(9,E,2,0,"div",7),e.k0s(),e.DNE(10,j,12,1,"div",8)(11,F,14,1,"div",9)(12,w,13,0,"div",9)),2&o&&(e.R7$(2),e.Y8G("ngForOf",s.taskTypes),e.R7$(6),e.Y8G("ngIf",s.todayTasks.length>0),e.R7$(),e.Y8G("ngIf",0===s.todayTasks.length),e.R7$(),e.Y8G("ngIf",s.isModalOpen),e.R7$(),e.Y8G("ngIf",s.isEditModalOpen),e.R7$(),e.Y8G("ngIf",s.isDeleteModalOpen))},dependencies:[k.MD,k.YU,k.Sq,k.bT,l.YN,l.xH,l.y7,l.me,l.wz,l.BC,l.vS]})}}return a})()}}]);