"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[542],{8542:(C,g,r)=>{r.r(g),r.d(g,{default:()=>S});var t=r(4438),h=r(177),f=r(7471),p=r(4796),m=r(3062);let k=(()=>{class n{constructor(){this.notifications=[]}getAll(){return[...this.notifications]}getUnreadCount(){return this.notifications.filter(e=>!e.leido).length}add(e){const i={id:crypto.randomUUID(),mensaje:e,fecha:new Date,leido:!1};this.notifications.unshift(i)}markAsRead(e){const i=this.notifications.find(s=>s.id===e);i&&(i.leido=!0)}clear(){this.notifications=[]}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var b=r(2656);const v=["notifDropdown"];function x(n,c){if(1&n&&(t.j41(0,"span",16),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.unreadCount," ")}}function y(n,c){if(1&n){const e=t.RV6();t.j41(0,"div",20),t.bIt("click",function(){const s=t.eBV(e).$implicit,o=t.XpG(2);return t.Njj(o.markAsRead(s.id))}),t.j41(1,"p",21),t.EFF(2),t.k0s(),t.j41(3,"p",22),t.EFF(4),t.nI1(5,"date"),t.k0s()()}if(2&n){const e=c.$implicit;t.AVh("font-semibold",!e.leido),t.R7$(2),t.JRh(e.mensaje),t.R7$(2),t.JRh(t.i5U(5,4,e.fecha,"short"))}}function w(n,c){1&n&&(t.j41(0,"div",23),t.EFF(1," Sin notificaciones "),t.k0s())}function F(n,c){if(1&n&&(t.j41(0,"div",17,0),t.DNE(2,y,6,7,"div",18)(3,w,2,0,"div",19),t.k0s()),2&n){const e=t.XpG();t.R7$(2),t.Y8G("ngForOf",e.notifications),t.R7$(),t.Y8G("ngIf",0===e.notifications.length)}}let M=(()=>{class n{constructor(e,i,s,o){this.dateService=e,this.router=i,this.notificacionService=s,this.taskService=o,this.showMonthModal=!1,this.years=[],this.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.selectedYear=null,this.selectedMonth=null,this.currentYear="",this.currentMonth="",this.currentRoute="",this.userName="",this.isDarkMode=!1,this.notifications=[],this.unreadCount=0,this.showNotifications=!1,this.authService=(0,t.WQX)(p.u)}ngOnInit(){this.generateYearRange(2025,2050),this.syncNotificacionesLocales();const e=new Date,i=e.getFullYear(),s=e.getMonth(),o=this.dateService.getSelectedYear(),a=this.dateService.getSelectedMonth();o&&a?(this.selectedYear=parseInt(o),this.selectedMonth=parseInt(a)-1,this.dateService.setDate(this.selectedYear,this.selectedMonth+1)):(this.selectedYear=i,this.selectedMonth=s,this.dateService.setDate(i,s+1)),this.dateSubscription=this.dateService.selectedDate$.subscribe(({year:l,month:u})=>{this.currentYear=l??"",this.currentMonth=u??""}),this.routeSubscription=this.router.events.subscribe(l=>{if(l instanceof f.wF){const u=l.urlAfterRedirects.split("/");this.currentRoute=this.mapRouteToTitle(u[u.length-1])}}),this.loadNotifications(),"true"===localStorage.getItem("darkMode")&&(this.isDarkMode=!0,document.documentElement.classList.add("dark")),this.checkTareasDelDia()}ngOnDestroy(){this.dateSubscription?.unsubscribe(),this.routeSubscription?.unsubscribe()}generateYearRange(e,i){this.years=[];for(let s=e;s<=i;s++)this.years.push(s)}openMonthModal(){this.showMonthModal=!0}closeMonthModal(){this.showMonthModal=!1}clearYearSelection(){this.selectedYear=null}selectYear(e){this.selectedYear=e}selectMonth(e){this.selectedMonth=e,this.showMonthModal=!1;const i=e+1;this.dateService.setDate(this.selectedYear,i),console.log("Fecha seleccionada \u2192",this.selectedYear,i);const o=this.authService.getUser()?.id;if(o){const a=this.selectedYear.toString(),d=i.toString().padStart(2,"0");this.dateService.notifyMonthChange(o,a,d)}}mapRouteToTitle(e){switch(e){case"expense":return"Gastos";case"income":return"Ingresos";case"wallet":return"Cartera";case"saving":return"Ahorros";case"loan":return"Pr\xe9stamos";case"debt":return"Deudas";case"home":return"Inicio";default:return this.capitalize(e)}}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}handleClickOutside(e){const i=e.target,s=this.notifDropdownRef?.nativeElement.contains(i),o=i.closest("[data-toggle-notif]");!s&&!o&&(this.showNotifications=!1)}toggleDarkMode(){this.isDarkMode=!this.isDarkMode;const e=document.documentElement;this.isDarkMode?(e.classList.add("dark"),localStorage.setItem("darkMode","true")):(e.classList.remove("dark"),localStorage.setItem("darkMode","false"))}toggleNotifications(){this.showNotifications=!this.showNotifications}loadNotifications(){const i=this.authService.getUser()?.id;i&&this.authService.getUserNotifications(i).subscribe(s=>{s&&(this.notifications=Object.entries(s).map(([o,a])=>({id:o,...a})),this.unreadCount=this.notifications.filter(o=>!o.leido).length)})}markAsRead(e){const s=this.authService.getUser()?.id;s&&this.authService.markNotificationAsRead(s,e).subscribe(()=>{this.notifications=this.notifications.map(o=>(o.id===e&&(o.leido=!0),o)),this.unreadCount=this.notifications.filter(o=>!o.leido).length})}logout(){this.authService.logout(),this.router.navigate(["/auth/login"])}syncNotificacionesLocales(){this.notifications=this.notificacionService.getAll(),this.unreadCount=this.notificacionService.getUnreadCount()}checkTareasDelDia(){this.taskService.getTodayTasks().subscribe(e=>{const i={};e.forEach(s=>{if("realizado"!==s.estado){const o=s.tipo||"sin_clasificar";i[o]=(i[o]||0)+1}});for(const s in i){const o=this.formatearNombreTipo(s);this.notificacionService.add(`Tienes ${i[s]} tareas pendientes hoy del tipo "${o}".`)}this.taskService.getAllTasks().subscribe(s=>{const o=new Date,a=s.filter(d=>{if(!d.fecha||"no realizado"!==d.estado)return!1;const l=new Date(d.fecha);return!isNaN(l.getTime())&&l<o&&!this.mismoDia(l,o)});a.length>0&&this.notificacionService.add(`Tienes ${a.length} tareas retrasadas sin completar.`),this.syncNotificacionesLocales()})})}formatearNombreTipo(e){return e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}mismoDia(e,i){return e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(m.k),t.rXU(f.Ix),t.rXU(k),t.rXU(b.R))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-header"]],viewQuery:function(i,s){if(1&i&&t.GBs(v,5),2&i){let o;t.mGM(o=t.lsd())&&(s.notifDropdownRef=o.first)}},hostBindings:function(i,s){1&i&&t.bIt("click",function(a){return s.handleClickOutside(a)},!1,t.EBC)},standalone:!0,features:[t.aNF],decls:25,vars:7,consts:[["notifDropdown",""],[1,"flex","flex-col","md:flex-row","md:justify-between","md:items-center","gap-6"],[1,"capitalize","flex-1","flex","items-center","gap-3"],["alt","Kronely Task Logo",1,"h-20","w-20","transition","duration-300",3,"src"],[1,"text-sm","font-semibold","text-gray-600","mb-1","dark:text-white"],[1,"tracking-normal","text-base","font-semibold","leading-relaxed","text-gray-900","dark:text-white"],[1,"flex","flex-wrap","justify-end","gap-3","items-center","w-full","md:w-auto"],[1,"bg-sky-600","hover:bg-sky-700","text-white","px-3","py-1","rounded-md","transition",3,"click"],[1,"flex","items-center","px-3","py-1","rounded-md","transition","bg-sky-600","text-white","hover:bg-sky-700","dark:bg-sky-100","dark:text-sky-800","dark:hover:bg-sky-200",3,"click"],[1,"material-icons","mr-1"],[1,"relative"],["data-toggle-notif","",1,"relative","p-2","rounded-full","hover:bg-sky-100","dark:hover:bg-sky-700","transition",3,"click"],[1,"material-icons","text-gray-700","dark:text-white"],["class","absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full px-1",4,"ngIf"],["class","absolute right-0 mt-2 w-80 bg-white dark:bg-slate-700 border rounded shadow-lg z-50 max-h-96 overflow-auto",4,"ngIf"],[1,"flex","items-center","bg-slate-500","text-white","px-3","py-1","rounded-md","hover:bg-slate-600","transition",3,"click"],[1,"absolute","top-0","right-0","bg-red-500","text-white","text-xs","rounded-full","px-1"],[1,"absolute","right-0","mt-2","w-80","bg-white","dark:bg-slate-700","border","rounded","shadow-lg","z-50","max-h-96","overflow-auto"],["class","p-4 border-b hover:bg-gray-100 dark:hover:bg-slate-600 cursor-pointer",3,"font-semibold","click",4,"ngFor","ngForOf"],["class","p-4 text-sm text-gray-500 dark:text-gray-300 text-center",4,"ngIf"],[1,"p-4","border-b","hover:bg-gray-100","dark:hover:bg-slate-600","cursor-pointer",3,"click"],[1,"text-sm","text-gray-700","dark:text-white"],[1,"text-xs","text-gray-400"],[1,"p-4","text-sm","text-gray-500","dark:text-gray-300","text-center"]],template:function(i,s){1&i&&(t.j41(0,"div",1)(1,"div",2),t.nrm(2,"img",3),t.j41(3,"div")(4,"p",4),t.EFF(5),t.k0s(),t.j41(6,"h6",5),t.EFF(7," Organiza tus Deberes con Claridad "),t.k0s()()(),t.j41(8,"div",6)(9,"button",7),t.bIt("click",function(){return s.openMonthModal()}),t.EFF(10," Cambiar Mes "),t.k0s(),t.j41(11,"button",8),t.bIt("click",function(){return s.toggleDarkMode()}),t.j41(12,"span",9),t.EFF(13),t.k0s(),t.EFF(14),t.k0s(),t.j41(15,"div",10)(16,"button",11),t.bIt("click",function(){return s.toggleNotifications()}),t.j41(17,"span",12),t.EFF(18,"notifications"),t.k0s(),t.DNE(19,x,2,1,"span",13),t.k0s(),t.DNE(20,F,4,2,"div",14),t.k0s(),t.j41(21,"button",15),t.bIt("click",function(){return s.logout()}),t.j41(22,"span",9),t.EFF(23,"logout"),t.k0s(),t.EFF(24," Salir "),t.k0s()()()),2&i&&(t.R7$(2),t.Y8G("src",s.isDarkMode?"assets/img/logoB.png":"assets/img/logo.png",t.B4B),t.R7$(3),t.Lme(" Fecha actual: ",s.currentYear,"/",s.currentMonth," "),t.R7$(8),t.SpI(" ",s.isDarkMode?"light_mode":"dark_mode"," "),t.R7$(),t.SpI(" ",s.isDarkMode?"Claro":"Oscuro"," "),t.R7$(5),t.Y8G("ngIf",s.unreadCount>0),t.R7$(),t.Y8G("ngIf",s.showNotifications))},dependencies:[h.MD,h.Sq,h.bT,h.vh]})}}return n})(),D=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-footer"]],standalone:!0,features:[t.aNF],decls:15,vars:0,consts:[[1,"py-2"],[1,"flex","w-full","flex-wrap","items-center","justify-center","gap-6","px-2","md:justify-between"],[1,"block","antialiased","font-sans","text-sm","leading-normal","font-normal","text-inherit"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor","aria-hidden","true",1,"-mt-0.5","inline-block","h-3.5","w-3.5"],[1,"flex","items-center","gap-4"],["href","https://juanzarta.github.io/GoldenPanda/","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"],["href","https://api.whatsapp.com/send/?phone=573128622945&text&type=phone_number&app_absent=0","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"],["href","https://github.com/JUANZARTA","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"]],template:function(i,s){1&i&&(t.j41(0,"footer",0)(1,"div",1)(2,"p",2),t.EFF(3,"\xa9 2025, Created by Juan camilo Zarta "),t.qSk(),t.nrm(4,"svg",3),t.k0s(),t.joV(),t.j41(5,"ul",4)(6,"li")(7,"a",5),t.EFF(8,"Golden Panda"),t.k0s()(),t.j41(9,"li")(10,"a",6),t.EFF(11,"About Us"),t.k0s()(),t.j41(12,"li")(13,"a",7),t.EFF(14,"GitHub"),t.k0s()()()()())}})}}return n})(),S=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-layout"]],standalone:!0,features:[t.aNF],decls:8,vars:0,consts:[[1,"min-h-screen","bg-gray-50/50","dark:bg-slate-900"],[1,"p-4","w-full"],[1,"block","w-full","max-w-full","bg-transparent","text-white","shadow-none","rounded-xl","transition-all","px-0","py-1"],[1,"mt-12"],[1,"text-blue-gray-600","dark:text-white"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"nav",2),t.nrm(3,"app-header"),t.k0s(),t.j41(4,"div",3),t.nrm(5,"router-outlet"),t.k0s(),t.j41(6,"div",4),t.nrm(7,"app-footer"),t.k0s()()())},dependencies:[M,D,f.n3]})}}return n})()}}]);