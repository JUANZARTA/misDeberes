"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[713],{8713:(E,p,r)=>{r.r(p),r.d(p,{CategoryComponent:()=>T});var d=r(177),i=r(9417),e=r(4438),g=r(7471),_=r(2656),m=r(9211);function h(n,c){if(1&n){const t=e.RV6();e.j41(0,"tr",19)(1,"td",20),e.EFF(2),e.k0s(),e.j41(3,"td",21),e.EFF(4),e.k0s(),e.j41(5,"td",22),e.EFF(6),e.nI1(7,"date"),e.k0s(),e.j41(8,"td",22)(9,"select",23),e.mxI("ngModelChange",function(a){const o=e.eBV(t).$implicit;return e.DH7(o.estado,a)||(o.estado=a),e.Njj(a)}),e.bIt("change",function(){const a=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.changeTaskStatus(a))}),e.j41(10,"option",24),e.EFF(11,"Pendiente"),e.k0s(),e.j41(12,"option",25),e.EFF(13,"Realizado"),e.k0s(),e.j41(14,"option",26),e.EFF(15,"No realizado"),e.k0s(),e.j41(16,"option",27),e.EFF(17,"Para hoy"),e.k0s()()(),e.j41(18,"td",22)(19,"button",28),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openEditModal(a))}),e.j41(20,"span",29),e.EFF(21,"edit"),e.k0s()(),e.j41(22,"button",30),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openDeleteModal(a))}),e.j41(23,"span",31),e.EFF(24,"delete"),e.k0s()()()()}if(2&n){const t=c.$implicit,s=e.XpG();e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.JRh(t.nota||"-"),e.R7$(2),e.SpI(" ",t.fecha?e.i5U(7,5,t.fecha,"EEEE d"):"(por definir)"," "),e.R7$(3),e.R50("ngModel",t.estado),e.Y8G("ngClass",s.getEstadoColor(t))}}function k(n,c){if(1&n){const t=e.RV6();e.j41(0,"div",32)(1,"div",33)(2,"h2",34),e.EFF(3,"Nueva Tarea"),e.k0s(),e.j41(4,"label",35),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",36),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.newTask.nombre,a)||(o.newTask.nombre=a),e.Njj(a)}),e.k0s(),e.j41(7,"label",35),e.EFF(8,"Nota adicional:"),e.k0s(),e.j41(9,"textarea",37),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.newTask.nota,a)||(o.newTask.nota=a),e.Njj(a)}),e.k0s(),e.j41(10,"label",35),e.EFF(11,"Fecha (d\xeda):"),e.k0s(),e.j41(12,"input",38),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.newTask.fecha,a)||(o.newTask.fecha=a),e.Njj(a)}),e.k0s(),e.j41(13,"div",39)(14,"button",40),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.closeAddModal())}),e.EFF(15,"Cancelar"),e.k0s(),e.j41(16,"button",41),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.addTask())}),e.EFF(17,"Agregar"),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newTask.nombre),e.R7$(3),e.R50("ngModel",t.newTask.nota),e.R7$(3),e.R50("ngModel",t.newTask.fecha)}}function u(n,c){if(1&n){const t=e.RV6();e.j41(0,"div",32)(1,"div",33)(2,"h2",34),e.EFF(3,"Editar Tarea"),e.k0s(),e.j41(4,"label",35),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",36),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.editedTask.nombre,a)||(o.editedTask.nombre=a),e.Njj(a)}),e.k0s(),e.j41(7,"label",35),e.EFF(8,"Nota:"),e.k0s(),e.j41(9,"textarea",37),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.editedTask.nota,a)||(o.editedTask.nota=a),e.Njj(a)}),e.k0s(),e.j41(10,"label",35),e.EFF(11,"Fecha:"),e.k0s(),e.j41(12,"input",38),e.mxI("ngModelChange",function(a){e.eBV(t);const o=e.XpG();return e.DH7(o.editedTask.fecha,a)||(o.editedTask.fecha=a),e.Njj(a)}),e.k0s(),e.j41(13,"div",39)(14,"button",40),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.closeEditModal())}),e.EFF(15,"Cancelar"),e.k0s(),e.j41(16,"button",42),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.saveTaskEdit())}),e.EFF(17," Guardar "),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.editedTask.nombre),e.R7$(3),e.R50("ngModel",t.editedTask.nota),e.R7$(3),e.R50("ngModel",t.editedTask.fecha)}}function b(n,c){if(1&n){const t=e.RV6();e.j41(0,"div",32)(1,"div",43)(2,"span",44),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",45),e.EFF(5,"\xbfEliminar Tarea?"),e.k0s(),e.j41(6,"p",46),e.EFF(7,"\xbfEst\xe1s seguro de eliminar esta tarea? Esta acci\xf3n no se puede deshacer."),e.k0s(),e.j41(8,"div",47)(9,"button",48),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.closeDeleteModal())}),e.EFF(10,"Cancelar"),e.k0s(),e.j41(11,"button",49),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.confirmDeleteTask())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let T=(()=>{class n{constructor(t,s,a,o){this.route=t,this.router=s,this.taskService=a,this.taskTypeService=o,this.taskTypeName="",this.taskTypeDisplayName="",this.editedOriginalName="",this.isEditModalOpen=!1,this.editedTask={},this.isDeleteModalOpen=!1,this.taskToDeleteKey="",this.tasks=[],this.isAddModalOpen=!1,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}ngOnInit(){this.taskTypeName=this.route.snapshot.paramMap.get("name")||"",console.log("[INIT] Tareas para tipo:",this.taskTypeName),this.loadTasks(),this.loadTaskTypeDisplayName()}loadTasks(){this.taskService.getTasks(this.taskTypeName).subscribe({next:t=>{const s=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate());console.log("[DEBUG] Fecha actual local:",s.toISOString(),"| Solo fecha:",a.toDateString()),this.tasks=t.map(o=>{if("realizado"===o.estado)return o;if(o.fecha){const l=this.parseFechaLocal(o.fecha);console.log("[DEBUG] Tarea:",o.nombre,"| Fecha tarea:",l.toDateString()),o.estado=l.getTime()===a.getTime()?"para hoy":l.getTime()<a.getTime()?"no realizado":"pendiente"}else o.estado="pendiente";return o}),this.tasks.forEach(o=>{const l=o.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,l,o).subscribe()}),console.log("[TAREAS]",this.tasks)},error:t=>console.error("[ERROR] Al cargar tareas:",t)})}goBack(){this.router.navigate(["/app/home"])}toggleTaskStatus(t){const s=["pendiente","para hoy","realizado","no realizado"],o=s.indexOf(t.estado),l=s[(o+1)%s.length],f={...t,estado:l},x=t.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,x,f).subscribe({next:()=>this.loadTasks(),error:y=>console.error("[ERROR] Al cambiar estado:",y)})}openAddModal(){this.isAddModalOpen=!0,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}closeAddModal(){this.isAddModalOpen=!1,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}addTask(){this.newTask.nombre.trim()&&this.taskService.addTask(this.taskTypeName,this.newTask).subscribe({next:()=>{this.loadTasks(),this.closeAddModal()},error:t=>console.error("[ERROR] Al agregar tarea:",t)})}openEditModal(t){this.editedTask={...t},this.editedOriginalName=t.nombre,this.isEditModalOpen=!0}saveTaskEdit(){if(!this.editedTask?.nombre?.trim())return;const t=this.editedTask.nombre.trim().toLowerCase().replace(/\s+/g,"_"),s=this.editedOriginalName.trim().toLowerCase().replace(/\s+/g,"_");this.editedTask.nombre=this.editedTask.nombre.trim(),t!==s&&this.taskService.deleteTask(this.taskTypeName,s).subscribe(),this.taskService.updateTask(this.taskTypeName,t,this.editedTask).subscribe({next:()=>{this.loadTasks(),this.closeEditModal()},error:a=>console.error("[ERROR] Al editar tarea:",a)})}closeEditModal(){this.isEditModalOpen=!1,this.editedTask={}}openDeleteModal(t){this.taskToDeleteKey=t.nombre.trim().toLowerCase().replace(/\s+/g,"_"),this.isDeleteModalOpen=!0}confirmDeleteTask(){this.taskService.deleteTask(this.taskTypeName,this.taskToDeleteKey).subscribe({next:()=>{this.loadTasks(),this.closeDeleteModal()},error:t=>console.error("[ERROR] Al eliminar tarea:",t)})}closeDeleteModal(){this.taskToDeleteKey="",this.isDeleteModalOpen=!1}loadTaskTypeDisplayName(){this.taskTypeService.getAllTaskTypes().subscribe({next:t=>{const s=t.find(a=>a.key===this.taskTypeName);this.taskTypeDisplayName=s?.nombre||this.taskTypeName},error:t=>console.error("[ERROR] Al obtener nombre visual:",t)})}changeTaskStatus(t){const s=t.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,s,t).subscribe({next:()=>this.loadTasks(),error:a=>console.error("[ERROR] Al actualizar estado:",a)})}getEstadoColor(t){const s=new Date,a=t.fecha?new Date(t.fecha):null;return"realizado"===t.estado?"bg-teal-600":"para hoy"===t.estado?"bg-orange-600":"no realizado"===t.estado&&a&&a<s?"bg-red-600":"bg-slate-500"}parseFechaLocal(t){const[s,a,o]=t.split("-").map(Number);return new Date(s,a-1,o)}static{this.\u0275fac=function(s){return new(s||n)(e.rXU(g.nX),e.rXU(g.Ix),e.rXU(_.R),e.rXU(m.z))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-category"]],standalone:!0,features:[e.aNF],decls:37,vars:5,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-1","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","border","border-gray-200"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-emerald-700","to-teal-700","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"text-xl"],[1,"flex","gap-3","items-center"],[1,"text-white","hover:underline","flex","items-center","gap-1",3,"click"],[1,"material-icons"],[1,"bg-white","text-sky-800","px-4","py-2","rounded-md","shadow-md","hover:bg-slate-200","transition","font-semibold","flex","items-center","gap-2",3,"click"],[1,"material-icons","text-sky-800"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-gray-700"],[1,"py-4","px-6","text-center"],[1,"text-xs","font-semibold","px-3","py-1","rounded-full","shadow-sm","border","text-white",3,"ngModelChange","change","ngModel","ngClass"],["value","pendiente",1,"text-black","bg-slate-100"],["value","realizado",1,"text-black","bg-slate-100"],["value","no realizado",1,"text-black","bg-slate-100"],["value","para hoy",1,"text-black","bg-slate-100"],[1,"text-sky-700","text-xl",3,"click"],[1,"material-icons","text-sky-700"],[1,"text-orange-600","text-xl",3,"click"],[1,"material-icons","text-orange-600"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-40","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-1","font-medium"],["type","text",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],["rows","2",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],["type","date",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-sky-800",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(s,a){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h6",3),e.EFF(5,"Tareas"),e.k0s(),e.j41(6,"p",4)(7,"strong",5),e.EFF(8),e.k0s()()(),e.j41(9,"div",6)(10,"button",7),e.bIt("click",function(){return a.goBack()}),e.j41(11,"span",8),e.EFF(12,"arrow_back"),e.k0s(),e.EFF(13," Regresar "),e.k0s(),e.j41(14,"button",9),e.bIt("click",function(){return a.openAddModal()}),e.j41(15,"span",10),e.EFF(16,"add"),e.k0s(),e.EFF(17," Agregar "),e.k0s()()(),e.j41(18,"div",11)(19,"table",12)(20,"thead",13)(21,"tr",14)(22,"th",15),e.EFF(23,"Nombre"),e.k0s(),e.j41(24,"th",15),e.EFF(25,"Nota"),e.k0s(),e.j41(26,"th",16),e.EFF(27,"Fecha"),e.k0s(),e.j41(28,"th",16),e.EFF(29,"Estado"),e.k0s(),e.j41(30,"th",16),e.EFF(31,"Acciones"),e.k0s()()(),e.j41(32,"tbody"),e.DNE(33,h,25,8,"tr",17),e.k0s()()()()(),e.DNE(34,k,18,3,"div",18)(35,u,18,3,"div",18)(36,b,13,0,"div",18)),2&s&&(e.R7$(8),e.JRh(a.taskTypeDisplayName),e.R7$(25),e.Y8G("ngForOf",a.tasks),e.R7$(),e.Y8G("ngIf",a.isAddModalOpen),e.R7$(),e.Y8G("ngIf",a.isEditModalOpen),e.R7$(),e.Y8G("ngIf",a.isDeleteModalOpen))},dependencies:[d.MD,d.YU,d.Sq,d.bT,d.vh,i.YN,i.xH,i.y7,i.me,i.wz,i.BC,i.vS],encapsulation:2})}}return n})()}}]);