"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[493],{1493:(w,h,r)=>{r.r(h),r.d(h,{CategoryComponent:()=>E});var d=r(177),l=r(9417),e=r(4438),g=r(7471),u=r(6354),k=r(9437),m=r(7673),p=r(8810),b=r(4796),f=r(3062),T=r(1562);let y=(()=>{class n{constructor(a,o,t){this.authService=a,this.dateService=o,this.http=t,this.dbUrl="https://misdeberes-fac01-default-rtdb.firebaseio.com"}getPath(a){const o=this.authService.getUser(),t=this.dateService.getSelectedYear(),s=this.dateService.getSelectedMonth();return o?.id&&t&&s?`${this.dbUrl}/${o.id}/${t}/${s}/categorias/${a}/tareas`:null}getTasks(a){const o=this.getPath(a);return o?this.http.get(`${o}.json`).pipe((0,u.T)(t=>t?Object.keys(t).map(s=>({...t[s],nombre:s})):[]),(0,k.W)(t=>(console.error("[ERROR][GET TASKS]",t),(0,m.of)([])))):(0,m.of)([])}addTask(a,o){const t=this.getPath(a);if(!t||!o?.nombre)return(0,p.$)(()=>new Error("Datos inv\xe1lidos"));const s=o.nombre.trim().toLowerCase().replace(/\s+/g,"_");return this.http.patch(`${t}.json`,{[s]:o})}deleteTask(a,o){const t=this.getPath(a);return t&&o?this.http.delete(`${t}/${o}.json`):(0,p.$)(()=>new Error("Datos inv\xe1lidos"))}updateTask(a,o,t){const s=this.getPath(a);return s&&o&&t?this.http.put(`${s}/${o}.json`,t):(0,p.$)(()=>new Error("Datos inv\xe1lidos"))}static{this.\u0275fac=function(o){return new(o||n)(e.KVO(b.u),e.KVO(f.k),e.KVO(T.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var x=r(9211);function _(n,c){if(1&n){const a=e.RV6();e.j41(0,"tr",19)(1,"td",20),e.EFF(2),e.k0s(),e.j41(3,"td",21),e.EFF(4),e.k0s(),e.j41(5,"td",22),e.EFF(6),e.nI1(7,"date"),e.k0s(),e.j41(8,"td",22)(9,"select",23),e.mxI("ngModelChange",function(t){const s=e.eBV(a).$implicit;return e.DH7(s.estado,t)||(s.estado=t),e.Njj(t)}),e.bIt("change",function(){const t=e.eBV(a).$implicit,s=e.XpG();return e.Njj(s.changeTaskStatus(t))}),e.j41(10,"option",24),e.EFF(11,"Pendiente"),e.k0s(),e.j41(12,"option",25),e.EFF(13,"Realizado"),e.k0s(),e.j41(14,"option",26),e.EFF(15,"No realizado"),e.k0s(),e.j41(16,"option",27),e.EFF(17,"Para hoy"),e.k0s()()(),e.j41(18,"td",22)(19,"button",28),e.bIt("click",function(){const t=e.eBV(a).$implicit,s=e.XpG();return e.Njj(s.openEditModal(t))}),e.j41(20,"span",29),e.EFF(21,"edit"),e.k0s()(),e.j41(22,"button",30),e.bIt("click",function(){const t=e.eBV(a).$implicit,s=e.XpG();return e.Njj(s.openDeleteModal(t))}),e.j41(23,"span",31),e.EFF(24,"delete"),e.k0s()()()()}if(2&n){const a=c.$implicit,o=e.XpG();e.R7$(2),e.JRh(a.nombre),e.R7$(2),e.JRh(a.nota||"-"),e.R7$(2),e.SpI(" ",a.fecha?e.i5U(7,5,a.fecha,"EEEE d"):"(por definir)"," "),e.R7$(3),e.R50("ngModel",a.estado),e.Y8G("ngClass",o.getEstadoColor(a))}}function F(n,c){if(1&n){const a=e.RV6();e.j41(0,"div",32)(1,"div",33)(2,"h2",34),e.EFF(3,"Nueva Tarea"),e.k0s(),e.j41(4,"label",35),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",36),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.newTask.nombre,t)||(s.newTask.nombre=t),e.Njj(t)}),e.k0s(),e.j41(7,"label",35),e.EFF(8,"Nota adicional:"),e.k0s(),e.j41(9,"textarea",37),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.newTask.nota,t)||(s.newTask.nota=t),e.Njj(t)}),e.k0s(),e.j41(10,"label",35),e.EFF(11,"Fecha (d\xeda):"),e.k0s(),e.j41(12,"input",38),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.newTask.fecha,t)||(s.newTask.fecha=t),e.Njj(t)}),e.k0s(),e.j41(13,"div",39)(14,"button",40),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.closeAddModal())}),e.EFF(15,"Cancelar"),e.k0s(),e.j41(16,"button",41),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.addTask())}),e.EFF(17,"Agregar"),e.k0s()()()()}if(2&n){const a=e.XpG();e.R7$(6),e.R50("ngModel",a.newTask.nombre),e.R7$(3),e.R50("ngModel",a.newTask.nota),e.R7$(3),e.R50("ngModel",a.newTask.fecha)}}function j(n,c){if(1&n){const a=e.RV6();e.j41(0,"div",32)(1,"div",33)(2,"h2",34),e.EFF(3,"Editar Tarea"),e.k0s(),e.j41(4,"label",35),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",36),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.editedTask.nombre,t)||(s.editedTask.nombre=t),e.Njj(t)}),e.k0s(),e.j41(7,"label",35),e.EFF(8,"Nota:"),e.k0s(),e.j41(9,"textarea",37),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.editedTask.nota,t)||(s.editedTask.nota=t),e.Njj(t)}),e.k0s(),e.j41(10,"label",35),e.EFF(11,"Fecha:"),e.k0s(),e.j41(12,"input",38),e.mxI("ngModelChange",function(t){e.eBV(a);const s=e.XpG();return e.DH7(s.editedTask.fecha,t)||(s.editedTask.fecha=t),e.Njj(t)}),e.k0s(),e.j41(13,"div",39)(14,"button",40),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.closeEditModal())}),e.EFF(15,"Cancelar"),e.k0s(),e.j41(16,"button",42),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.saveTaskEdit())}),e.EFF(17," Guardar "),e.k0s()()()()}if(2&n){const a=e.XpG();e.R7$(6),e.R50("ngModel",a.editedTask.nombre),e.R7$(3),e.R50("ngModel",a.editedTask.nota),e.R7$(3),e.R50("ngModel",a.editedTask.fecha)}}function C(n,c){if(1&n){const a=e.RV6();e.j41(0,"div",32)(1,"div",43)(2,"span",44),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",45),e.EFF(5,"\xbfEliminar Tarea?"),e.k0s(),e.j41(6,"p",46),e.EFF(7,"\xbfEst\xe1s seguro de eliminar esta tarea? Esta acci\xf3n no se puede deshacer."),e.k0s(),e.j41(8,"div",47)(9,"button",48),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.closeDeleteModal())}),e.EFF(10,"Cancelar"),e.k0s(),e.j41(11,"button",49),e.bIt("click",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.confirmDeleteTask())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let E=(()=>{class n{constructor(a,o,t,s){this.route=a,this.router=o,this.taskService=t,this.taskTypeService=s,this.taskTypeName="",this.taskTypeDisplayName="",this.editedOriginalName="",this.isEditModalOpen=!1,this.editedTask={},this.isDeleteModalOpen=!1,this.taskToDeleteKey="",this.tasks=[],this.isAddModalOpen=!1,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}ngOnInit(){this.taskTypeName=this.route.snapshot.paramMap.get("name")||"",console.log("[INIT] Tareas para tipo:",this.taskTypeName),this.loadTasks(),this.loadTaskTypeDisplayName()}loadTasks(){this.taskService.getTasks(this.taskTypeName).subscribe({next:a=>{const o=new Date,t=new Date(o.getFullYear(),o.getMonth(),o.getDate());console.log("[DEBUG] Fecha actual local:",o.toISOString(),"| Solo fecha:",t.toDateString()),this.tasks=a.map(s=>{if("realizado"===s.estado)return s;if(s.fecha){const i=this.parseFechaLocal(s.fecha);console.log("[DEBUG] Tarea:",s.nombre,"| Fecha tarea:",i.toDateString()),s.estado=i.getTime()===t.getTime()?"para hoy":i.getTime()<t.getTime()?"no realizado":"pendiente"}else s.estado="pendiente";return s}),this.tasks.forEach(s=>{const i=s.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,i,s).subscribe()}),console.log("[TAREAS]",this.tasks)},error:a=>console.error("[ERROR] Al cargar tareas:",a)})}goBack(){this.router.navigate(["/app/home"])}toggleTaskStatus(a){const o=["pendiente","para hoy","realizado","no realizado"],s=o.indexOf(a.estado),i=o[(s+1)%o.length],v={...a,estado:i},M=a.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,M,v).subscribe({next:()=>this.loadTasks(),error:R=>console.error("[ERROR] Al cambiar estado:",R)})}openAddModal(){this.isAddModalOpen=!0,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}closeAddModal(){this.isAddModalOpen=!1,this.newTask={nombre:"",nota:"",fecha:"",estado:"pendiente"}}addTask(){this.newTask.nombre.trim()&&this.taskService.addTask(this.taskTypeName,this.newTask).subscribe({next:()=>{this.loadTasks(),this.closeAddModal()},error:a=>console.error("[ERROR] Al agregar tarea:",a)})}openEditModal(a){this.editedTask={...a},this.editedOriginalName=a.nombre,this.isEditModalOpen=!0}saveTaskEdit(){if(!this.editedTask?.nombre?.trim())return;const a=this.editedTask.nombre.trim().toLowerCase().replace(/\s+/g,"_"),o=this.editedOriginalName.trim().toLowerCase().replace(/\s+/g,"_");a!==o&&this.taskService.deleteTask(this.taskTypeName,o).subscribe(),this.taskService.updateTask(this.taskTypeName,a,this.editedTask).subscribe({next:()=>{this.loadTasks(),this.closeEditModal()},error:t=>console.error("[ERROR] Al editar tarea:",t)})}closeEditModal(){this.isEditModalOpen=!1,this.editedTask={}}openDeleteModal(a){this.taskToDeleteKey=a.nombre,this.isDeleteModalOpen=!0}confirmDeleteTask(){this.taskService.deleteTask(this.taskTypeName,this.taskToDeleteKey).subscribe({next:()=>{this.loadTasks(),this.closeDeleteModal()},error:a=>console.error("[ERROR] Al eliminar tarea:",a)})}closeDeleteModal(){this.taskToDeleteKey="",this.isDeleteModalOpen=!1}loadTaskTypeDisplayName(){this.taskTypeService.getAllTaskTypes().subscribe({next:a=>{const o=a.find(t=>t.key===this.taskTypeName);this.taskTypeDisplayName=o?.nombre||this.taskTypeName},error:a=>console.error("[ERROR] Al obtener nombre visual:",a)})}changeTaskStatus(a){const o=a.nombre.trim().toLowerCase().replace(/\s+/g,"_");this.taskService.updateTask(this.taskTypeName,o,a).subscribe({next:()=>this.loadTasks(),error:t=>console.error("[ERROR] Al actualizar estado:",t)})}getEstadoColor(a){const o=new Date,t=a.fecha?new Date(a.fecha):null;return"realizado"===a.estado?"bg-teal-600":"para hoy"===a.estado?"bg-orange-600":"no realizado"===a.estado&&t&&t<o?"bg-red-600":"bg-slate-500"}parseFechaLocal(a){const[o,t,s]=a.split("-").map(Number);return new Date(o,t-1,s)}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(g.nX),e.rXU(g.Ix),e.rXU(y),e.rXU(x.z))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-category"]],standalone:!0,features:[e.aNF],decls:37,vars:5,consts:[[1,"mb-6","grid","grid-cols-1","xl:grid-cols-1","gap-6"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","border","border-gray-200"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-sky-800","to-sky-800","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"text-xl"],[1,"flex","gap-3","items-center"],[1,"text-white","hover:underline","flex","items-center","gap-1",3,"click"],[1,"material-icons"],[1,"bg-white","text-sky-800","px-4","py-2","rounded-md","shadow-md","hover:bg-slate-200","transition","font-semibold","flex","items-center","gap-2",3,"click"],[1,"material-icons","text-sky-800"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50",4,"ngIf"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-gray-700"],[1,"py-4","px-6","text-center"],[1,"text-xs","font-semibold","px-3","py-1","rounded-full","shadow-sm","border","text-white",3,"ngModelChange","change","ngModel","ngClass"],["value","pendiente",1,"text-black","bg-slate-100"],["value","realizado",1,"text-black","bg-slate-100"],["value","no realizado",1,"text-black","bg-slate-100"],["value","para hoy",1,"text-black","bg-slate-100"],[1,"text-sky-700","text-xl",3,"click"],[1,"material-icons","text-sky-700"],[1,"text-orange-600","text-xl",3,"click"],[1,"material-icons","text-orange-600"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-40","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-1","font-medium"],["type","text",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],["rows","2",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],["type","date",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-sky-800",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(o,t){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h6",3),e.EFF(5,"Tareas"),e.k0s(),e.j41(6,"p",4)(7,"strong",5),e.EFF(8),e.k0s()()(),e.j41(9,"div",6)(10,"button",7),e.bIt("click",function(){return t.goBack()}),e.j41(11,"span",8),e.EFF(12,"arrow_back"),e.k0s(),e.EFF(13," Regresar "),e.k0s(),e.j41(14,"button",9),e.bIt("click",function(){return t.openAddModal()}),e.j41(15,"span",10),e.EFF(16,"add"),e.k0s(),e.EFF(17," Agregar "),e.k0s()()(),e.j41(18,"div",11)(19,"table",12)(20,"thead",13)(21,"tr",14)(22,"th",15),e.EFF(23,"Nombre"),e.k0s(),e.j41(24,"th",15),e.EFF(25,"Nota"),e.k0s(),e.j41(26,"th",16),e.EFF(27,"Fecha"),e.k0s(),e.j41(28,"th",16),e.EFF(29,"Estado"),e.k0s(),e.j41(30,"th",16),e.EFF(31,"Acciones"),e.k0s()()(),e.j41(32,"tbody"),e.DNE(33,_,25,8,"tr",17),e.k0s()()()()(),e.DNE(34,F,18,3,"div",18)(35,j,18,3,"div",18)(36,C,13,0,"div",18)),2&o&&(e.R7$(8),e.JRh(t.taskTypeDisplayName),e.R7$(25),e.Y8G("ngForOf",t.tasks),e.R7$(),e.Y8G("ngIf",t.isAddModalOpen),e.R7$(),e.Y8G("ngIf",t.isEditModalOpen),e.R7$(),e.Y8G("ngIf",t.isDeleteModalOpen))},dependencies:[d.MD,d.YU,d.Sq,d.bT,d.vh,l.YN,l.xH,l.y7,l.me,l.wz,l.BC,l.vS],encapsulation:2})}}return n})()}}]);