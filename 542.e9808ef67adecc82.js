"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[542],{8542:(T,p,c)=>{c.r(p),c.d(p,{default:()=>I});var t=c(4438),u=c(177),f=c(7471),g=c(4796),m=c(3062);let b=(()=>{class n{constructor(){this.notifications=[]}getAll(){return[...this.notifications]}getUnreadCount(){return this.notifications.filter(e=>!e.leido).length}add(e){const i={id:crypto.randomUUID(),mensaje:e,fecha:new Date,leido:!1};this.notifications.unshift(i)}markAsRead(e){const i=this.notifications.find(o=>o.id===e);i&&(i.leido=!0)}clear(){this.notifications=[]}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var v=c(2656);const k=["notifDropdown"];function x(n,r){if(1&n){const e=t.RV6();t.j41(0,"button",26),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.selectYear(o))}),t.EFF(1),t.k0s()}if(2&n){const e=r.$implicit;t.R7$(),t.SpI(" ",e," ")}}function _(n,r){if(1&n&&(t.j41(0,"div",24),t.DNE(1,x,2,1,"button",25),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.years)}}function y(n,r){if(1&n){const e=t.RV6();t.j41(0,"button",31),t.bIt("click",function(){const o=t.eBV(e).index,s=t.XpG(3);return t.Njj(s.selectMonth(o))}),t.EFF(1),t.k0s()}if(2&n){const e=r.$implicit,i=r.index,o=t.XpG(3);t.AVh("bg-blue-500",i===o.selectedMonth)("text-cyan-700",i===o.selectedMonth),t.R7$(),t.SpI(" ",e," ")}}function w(n,r){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"div",27)(2,"button",28),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.clearYearSelection())}),t.EFF(3),t.k0s()(),t.j41(4,"div",29),t.DNE(5,y,2,5,"button",30),t.k0s()()}if(2&n){const e=t.XpG(2);t.R7$(3),t.SpI(" Cambiar A\xf1o (",e.selectedYear,") "),t.R7$(2),t.Y8G("ngForOf",e.months)}}function F(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",17)(1,"div",18)(2,"h2",19),t.EFF(3),t.k0s(),t.DNE(4,_,2,1,"div",20)(5,w,6,2,"div",21),t.j41(6,"div",22)(7,"button",23),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.closeMonthModal())}),t.EFF(8," Cerrar "),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(3),t.SpI(" ",e.selectedYear?"Selecciona un Mes":"Selecciona un A\xf1o"," "),t.R7$(),t.Y8G("ngIf",!e.selectedYear),t.R7$(),t.Y8G("ngIf",e.selectedYear)}}function M(n,r){if(1&n&&(t.j41(0,"span",32),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.unreadCount," ")}}function j(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",36),t.bIt("click",function(){const o=t.eBV(e).$implicit,s=t.XpG(2);return t.Njj(s.markAsRead(o.id))}),t.j41(1,"p",37),t.EFF(2),t.k0s(),t.j41(3,"p",38),t.EFF(4),t.nI1(5,"date"),t.k0s()()}if(2&n){const e=r.$implicit;t.AVh("font-semibold",!e.leido),t.R7$(2),t.JRh(e.mensaje),t.R7$(2),t.JRh(t.i5U(5,4,e.fecha,"short"))}}function S(n,r){1&n&&(t.j41(0,"div",39),t.EFF(1," Sin notificaciones "),t.k0s())}function C(n,r){if(1&n&&(t.j41(0,"div",33,0),t.DNE(2,j,6,7,"div",34)(3,S,2,0,"div",35),t.k0s()),2&n){const e=t.XpG();t.R7$(2),t.Y8G("ngForOf",e.notifications),t.R7$(),t.Y8G("ngIf",0===e.notifications.length)}}let D=(()=>{class n{constructor(e,i,o,s){this.dateService=e,this.router=i,this.notificacionService=o,this.taskService=s,this.showMonthModal=!1,this.years=[],this.months=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],this.selectedYear=null,this.selectedMonth=null,this.currentYear="",this.currentMonth="",this.currentRoute="",this.userName="",this.isDarkMode=!1,this.notifications=[],this.unreadCount=0,this.showNotifications=!1,this.authService=(0,t.WQX)(g.u)}ngOnInit(){this.generateYearRange(2025,2050),this.syncNotificacionesLocales();const e=new Date,i=e.getFullYear(),o=e.getMonth(),s=this.dateService.getSelectedYear(),a=this.dateService.getSelectedMonth();s&&a?(this.selectedYear=parseInt(s),this.selectedMonth=parseInt(a)-1,this.dateService.setDate(this.selectedYear,this.selectedMonth+1)):(this.selectedYear=i,this.selectedMonth=o,this.dateService.setDate(i,o+1)),this.dateSubscription=this.dateService.selectedDate$.subscribe(({year:l,month:h})=>{this.currentYear=l??"",this.currentMonth=h??""}),this.routeSubscription=this.router.events.subscribe(l=>{if(l instanceof f.wF){const h=l.urlAfterRedirects.split("/");this.currentRoute=this.mapRouteToTitle(h[h.length-1])}}),this.loadNotifications(),"true"===localStorage.getItem("darkMode")&&(this.isDarkMode=!0,document.documentElement.classList.add("dark")),this.checkTareasDelDia()}ngOnDestroy(){this.dateSubscription?.unsubscribe(),this.routeSubscription?.unsubscribe()}generateYearRange(e,i){this.years=[];for(let o=e;o<=i;o++)this.years.push(o)}openMonthModal(){this.showMonthModal=!0}closeMonthModal(){this.showMonthModal=!1}clearYearSelection(){this.selectedYear=null}selectYear(e){this.selectedYear=e}selectMonth(e){this.selectedMonth=e,this.showMonthModal=!1;const i=e+1;this.dateService.setDate(this.selectedYear,i),console.log("Fecha seleccionada \u2192",this.selectedYear,i);const s=this.authService.getUser()?.id;if(s){const a=this.selectedYear.toString(),d=i.toString().padStart(2,"0");this.dateService.notifyMonthChange(s,a,d)}}mapRouteToTitle(e){switch(e){case"expense":return"Gastos";case"income":return"Ingresos";case"wallet":return"Cartera";case"saving":return"Ahorros";case"loan":return"Pr\xe9stamos";case"debt":return"Deudas";case"home":return"Inicio";default:return this.capitalize(e)}}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}handleClickOutside(e){const i=e.target,o=this.notifDropdownRef?.nativeElement.contains(i),s=i.closest("[data-toggle-notif]");!o&&!s&&(this.showNotifications=!1)}toggleDarkMode(){this.isDarkMode=!this.isDarkMode;const e=document.documentElement;this.isDarkMode?(e.classList.add("dark"),localStorage.setItem("darkMode","true")):(e.classList.remove("dark"),localStorage.setItem("darkMode","false"))}toggleNotifications(){this.showNotifications=!this.showNotifications}loadNotifications(){const i=this.authService.getUser()?.id;i&&this.authService.getUserNotifications(i).subscribe(o=>{o&&(this.notifications=Object.entries(o).map(([s,a])=>({id:s,...a})),this.unreadCount=this.notifications.filter(s=>!s.leido).length)})}markAsRead(e){const o=this.authService.getUser()?.id;o&&this.authService.markNotificationAsRead(o,e).subscribe(()=>{this.notifications=this.notifications.map(s=>(s.id===e&&(s.leido=!0),s)),this.unreadCount=this.notifications.filter(s=>!s.leido).length})}logout(){this.authService.logout(),this.router.navigate(["/auth/login"])}syncNotificacionesLocales(){this.notifications=this.notificacionService.getAll(),this.unreadCount=this.notificacionService.getUnreadCount()}checkTareasDelDia(){this.taskService.getTodayTasks().subscribe(e=>{const i={};e.forEach(o=>{if("realizado"!==o.estado){const s=o.tipo||"sin_clasificar";i[s]=(i[s]||0)+1}});for(const o in i){const s=this.formatearNombreTipo(o);this.notificacionService.add(`Tienes ${i[o]} tareas pendientes hoy del tipo "${s}".`)}this.taskService.getAllTasks().subscribe(o=>{const s=new Date,a=o.filter(d=>{if(!d.fecha||"no realizado"!==d.estado)return!1;const l=new Date(d.fecha);return!isNaN(l.getTime())&&l<s&&!this.mismoDia(l,s)});a.length>0&&this.notificacionService.add(`Tienes ${a.length} tareas retrasadas sin completar.`),this.syncNotificacionesLocales()})})}formatearNombreTipo(e){return e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}mismoDia(e,i){return e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(m.k),t.rXU(f.Ix),t.rXU(b),t.rXU(v.R))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-header"]],viewQuery:function(i,o){if(1&i&&t.GBs(k,5),2&i){let s;t.mGM(s=t.lsd())&&(o.notifDropdownRef=s.first)}},hostBindings:function(i,o){1&i&&t.bIt("click",function(a){return o.handleClickOutside(a)},!1,t.EBC)},standalone:!0,features:[t.aNF],decls:26,vars:8,consts:[["notifDropdown",""],[1,"flex","flex-col","md:flex-row","md:justify-between","md:items-center","gap-6"],[1,"capitalize","flex-1","flex","items-center","gap-3"],["alt","Kronely Task Logo",1,"h-20","w-20","transition","duration-300",3,"src"],[1,"text-sm","font-semibold","text-gray-600","mb-1","dark:text-white"],[1,"tracking-normal","text-base","font-semibold","leading-relaxed","text-gray-900","dark:text-white"],[1,"flex","flex-wrap","justify-end","gap-3","items-center","w-full","md:w-auto"],[1,"ml-4","bg-blue-500","text-white","px-3","py-1","rounded-md",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",4,"ngIf"],[1,"flex","items-center","px-3","py-1","rounded-md","transition","bg-sky-600","text-white","hover:bg-sky-700","dark:bg-sky-100","dark:text-sky-800","dark:hover:bg-sky-200",3,"click"],[1,"material-icons","mr-1"],[1,"relative"],["data-toggle-notif","",1,"relative","p-2","rounded-full","hover:bg-sky-100","dark:hover:bg-sky-700","transition",3,"click"],[1,"material-icons","text-gray-700","dark:text-white"],["class","absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full px-1",4,"ngIf"],["class","absolute right-0 mt-2 w-80 bg-white dark:bg-slate-700 border rounded shadow-lg z-50 max-h-96 overflow-auto",4,"ngIf"],[1,"flex","items-center","bg-slate-500","text-white","px-3","py-1","rounded-md","hover:bg-slate-600","transition",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96","max-h-[90vh]","overflow-y-auto"],[1,"text-lg","font-semibold","mb-4","text-center"],["class","max-h-60 overflow-y-auto mb-4 px-1 py-2 border rounded-md space-y-2",4,"ngIf"],[4,"ngIf"],[1,"mt-4","flex","justify-end"],[1,"bg-red-500","text-white","px-4","py-2","rounded-lg","hover:bg-red-600",3,"click"],[1,"max-h-60","overflow-y-auto","mb-4","px-1","py-2","border","rounded-md","space-y-2"],["class","w-full px-4 py-2 rounded-lg bg-gray-200 hover:bg-blue-500 text-gray-800 hover:text-white transition text-center",3,"click",4,"ngFor","ngForOf"],[1,"w-full","px-4","py-2","rounded-lg","bg-gray-200","hover:bg-blue-500","text-gray-800","hover:text-white","transition","text-center",3,"click"],[1,"flex","justify-center","mb-4"],[1,"px-4","py-2","bg-blue-100","text-blue-800","font-medium","rounded-md","shadow-sm","hover:bg-blue-200","transition",3,"click"],[1,"grid","grid-cols-3","gap-2","mb-4"],["class","p-2 rounded-lg bg-gray-200 hover:bg-blue-500 text-gray-800 hover:text-white transition",3,"bg-blue-500","text-cyan-700","click",4,"ngFor","ngForOf"],[1,"p-2","rounded-lg","bg-gray-200","hover:bg-blue-500","text-gray-800","hover:text-white","transition",3,"click"],[1,"absolute","top-0","right-0","bg-red-500","text-white","text-xs","rounded-full","px-1"],[1,"absolute","right-0","mt-2","w-80","bg-white","dark:bg-slate-700","border","rounded","shadow-lg","z-50","max-h-96","overflow-auto"],["class","p-4 border-b hover:bg-gray-100 dark:hover:bg-slate-600 cursor-pointer",3,"font-semibold","click",4,"ngFor","ngForOf"],["class","p-4 text-sm text-gray-500 dark:text-gray-300 text-center",4,"ngIf"],[1,"p-4","border-b","hover:bg-gray-100","dark:hover:bg-slate-600","cursor-pointer",3,"click"],[1,"text-sm","text-gray-700","dark:text-white"],[1,"text-xs","text-gray-400"],[1,"p-4","text-sm","text-gray-500","dark:text-gray-300","text-center"]],template:function(i,o){1&i&&(t.j41(0,"div",1)(1,"div",2),t.nrm(2,"img",3),t.j41(3,"div")(4,"p",4),t.EFF(5),t.k0s(),t.j41(6,"h6",5),t.EFF(7," Organiza tus Deberes con Claridad "),t.k0s()()(),t.j41(8,"div",6)(9,"button",7),t.bIt("click",function(){return o.openMonthModal()}),t.EFF(10," Cambiar Mes\n"),t.k0s(),t.DNE(11,F,9,3,"div",8),t.j41(12,"button",9),t.bIt("click",function(){return o.toggleDarkMode()}),t.j41(13,"span",10),t.EFF(14),t.k0s(),t.EFF(15),t.k0s(),t.j41(16,"div",11)(17,"button",12),t.bIt("click",function(){return o.toggleNotifications()}),t.j41(18,"span",13),t.EFF(19,"notifications"),t.k0s(),t.DNE(20,M,2,1,"span",14),t.k0s(),t.DNE(21,C,4,2,"div",15),t.k0s(),t.j41(22,"button",16),t.bIt("click",function(){return o.logout()}),t.j41(23,"span",10),t.EFF(24,"logout"),t.k0s(),t.EFF(25," Salir "),t.k0s()()()),2&i&&(t.R7$(2),t.Y8G("src",o.isDarkMode?"assets/img/logoB.png":"assets/img/logo.png",t.B4B),t.R7$(3),t.Lme(" Fecha actual: ",o.currentYear,"/",o.currentMonth," "),t.R7$(6),t.Y8G("ngIf",o.showMonthModal),t.R7$(3),t.SpI(" ",o.isDarkMode?"light_mode":"dark_mode"," "),t.R7$(),t.SpI(" ",o.isDarkMode?"Claro":"Oscuro"," "),t.R7$(5),t.Y8G("ngIf",o.unreadCount>0),t.R7$(),t.Y8G("ngIf",o.showNotifications))},dependencies:[u.MD,u.Sq,u.bT,u.vh]})}}return n})(),R=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-footer"]],standalone:!0,features:[t.aNF],decls:15,vars:0,consts:[[1,"py-2"],[1,"flex","w-full","flex-wrap","items-center","justify-center","gap-6","px-2","md:justify-between"],[1,"block","antialiased","font-sans","text-sm","leading-normal","font-normal","text-inherit"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor","aria-hidden","true",1,"-mt-0.5","inline-block","h-3.5","w-3.5"],[1,"flex","items-center","gap-4"],["href","https://juanzarta.github.io/GoldenPanda/","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"],["href","https://api.whatsapp.com/send/?phone=573128622945&text&type=phone_number&app_absent=0","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"],["href","https://github.com/JUANZARTA","target","_blank",1,"block","antialiased","font-sans","text-sm","leading-normal","py-0.5","px-1","font-normal","text-inherit","transition-colors","hover:text-blue-500"]],template:function(i,o){1&i&&(t.j41(0,"footer",0)(1,"div",1)(2,"p",2),t.EFF(3,"\xa9 2025, Created by Juan camilo Zarta "),t.qSk(),t.nrm(4,"svg",3),t.k0s(),t.joV(),t.j41(5,"ul",4)(6,"li")(7,"a",5),t.EFF(8,"Golden Panda"),t.k0s()(),t.j41(9,"li")(10,"a",6),t.EFF(11,"About Us"),t.k0s()(),t.j41(12,"li")(13,"a",7),t.EFF(14,"GitHub"),t.k0s()()()()())}})}}return n})(),I=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-layout"]],standalone:!0,features:[t.aNF],decls:8,vars:0,consts:[[1,"min-h-screen","bg-gray-50/50","dark:bg-slate-900"],[1,"p-4","w-full"],[1,"block","w-full","max-w-full","bg-transparent","text-white","shadow-none","rounded-xl","transition-all","px-0","py-1"],[1,"mt-12"],[1,"text-blue-gray-600","dark:text-white"]],template:function(i,o){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"nav",2),t.nrm(3,"app-header"),t.k0s(),t.j41(4,"div",3),t.nrm(5,"router-outlet"),t.k0s(),t.j41(6,"div",4),t.nrm(7,"app-footer"),t.k0s()()())},dependencies:[D,R,f.n3]})}}return n})()}}]);