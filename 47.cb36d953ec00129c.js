"use strict";(self.webpackChunkmisDeberes=self.webpackChunkmisDeberes||[]).push([[47],{5047:(R,u,r)=>{r.r(u),r.d(u,{default:()=>M});var _=r(177),l=r(9417),h=r(4796),e=r(4438),g=r(9211),k=r(2656),b=r(3062),y=r(7471);function f(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",20)(1,"h3",21),e.EFF(2),e.k0s(),e.j41(3,"div",22)(4,"button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.enterTaskType(o))}),e.EFF(5,"INGRESAR"),e.k0s(),e.j41(6,"button",24),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.openEditModal(o))}),e.j41(7,"span",25),e.EFF(8,"edit"),e.k0s()(),e.j41(9,"button",26),e.bIt("click",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.openDeleteModal(o))}),e.j41(10,"span",27),e.EFF(11,"delete"),e.k0s()()()()}if(2&i){const t=d.$implicit;e.R7$(2),e.JRh(t.nombre)}}function x(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr",28)(1,"td",29),e.EFF(2),e.k0s(),e.j41(3,"td",30),e.EFF(4),e.k0s(),e.j41(5,"td",31),e.EFF(6),e.k0s(),e.j41(7,"td",32)(8,"select",33),e.mxI("ngModelChange",function(o){const a=e.eBV(t).$implicit;return e.DH7(a.estado,o)||(a.estado=o),e.Njj(o)}),e.bIt("change",function(){const o=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.changeTodayTaskStatus(o))}),e.j41(9,"option",34),e.EFF(10,"Pendiente"),e.k0s(),e.j41(11,"option",35),e.EFF(12,"Realizado"),e.k0s(),e.j41(13,"option",36),e.EFF(14,"No realizado"),e.k0s(),e.j41(15,"option",37),e.EFF(16,"Para hoy"),e.k0s()()()()}if(2&i){const t=d.$implicit,s=e.XpG();e.R7$(2),e.SpI(" ",s.todayTaskOrigins.get(t.nombre)||"-"," "),e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.JRh(t.nota||"-"),e.R7$(2),e.R50("ngModel",t.estado),e.Y8G("ngClass",s.getEstadoColor(t))}}function E(i,d){1&i&&(e.j41(0,"tr")(1,"td",38),e.EFF(2,"No hay tareas programadas para hoy."),e.k0s()())}function v(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",39)(1,"div",40)(2,"h2",41),e.EFF(3,"Nuevo Tipo de Tarea"),e.k0s(),e.j41(4,"label",42),e.EFF(5,"Nombre:"),e.k0s(),e.j41(6,"input",43),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.newTaskType,o)||(a.newTaskType=o),e.Njj(o)}),e.k0s(),e.j41(7,"div",44)(8,"button",45),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeModal())}),e.EFF(9,"Cancelar"),e.k0s(),e.j41(10,"button",46),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.addTaskType())}),e.EFF(11,"Agregar"),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.newTaskType)}}function F(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",47)(1,"div",40)(2,"h2",41),e.EFF(3,"Editar Tipo de Tarea"),e.k0s(),e.j41(4,"p",48),e.EFF(5,"Modifica el nombre del tipo de tarea."),e.k0s(),e.j41(6,"label",49),e.EFF(7,"Nuevo Nombre:"),e.k0s(),e.j41(8,"input",50),e.mxI("ngModelChange",function(o){e.eBV(t);const a=e.XpG();return e.DH7(a.editedTaskType,o)||(a.editedTaskType=o),e.Njj(o)}),e.k0s(),e.j41(9,"div",44)(10,"button",51),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeEditModal())}),e.EFF(11,"Cancelar"),e.k0s(),e.j41(12,"button",52),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.saveTaskTypeEdit())}),e.EFF(13," Guardar "),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(8),e.R50("ngModel",t.editedTaskType)}}function j(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",47)(1,"div",53)(2,"span",54),e.EFF(3," report_problem "),e.k0s(),e.j41(4,"h2",55),e.EFF(5,"\xbfEliminar Tipo de Tarea?"),e.k0s(),e.j41(6,"p",56),e.EFF(7,"\xbfEst\xe1s seguro de eliminar este tipo de tarea? Esta acci\xf3n no se puede deshacer."),e.k0s(),e.j41(8,"div",57)(9,"button",58),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeDeleteModal())}),e.EFF(10,"Cancelar"),e.k0s(),e.j41(11,"button",59),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.confirmDeleteTaskType())}),e.EFF(12," Eliminar "),e.k0s()()()()}}let M=(()=>{class i{constructor(t,s,o,a){this.taskTypeService=t,this.taskService=s,this.dateService=o,this.router=a,this.authService=(0,e.WQX)(h.u),this.taskTypes=[],this.isModalOpen=!1,this.newTaskType="",this.isEditModalOpen=!1,this.taskTypeToEdit="",this.editedTaskType="",this.isDeleteModalOpen=!1,this.taskTypeToDelete="",this.todayTasks=[],this.todayTaskOrigins=new Map}ngOnInit(){this.loadTaskTypes(),this.loadTodayTasks(),this.dateService.selectedDate$.subscribe(()=>{this.loadTaskTypes(),this.loadTodayTasks()}),this.dateService.selectedDate$.subscribe(t=>{console.log("[OBS] Fecha detectada:",t),this.loadTaskTypes(),this.loadTodayTasks()}),this.authService.startAutoLogout()}ngOnDestroy(){this.dateSubscription?.unsubscribe()}loadTaskTypes(){this.taskTypeService.getAllTaskTypes().subscribe({next:t=>{console.log("[GET] Tipos cargados:",t),this.taskTypes=t},error:t=>{console.error("[ERROR] Al obtener tipos de tarea:",t)}})}openModal(){this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.newTaskType=""}addTaskType(){this.newTaskType.trim()&&this.taskTypeService.addTaskType(this.newTaskType).subscribe({next:()=>{this.loadTaskTypes(),this.closeModal()},error:t=>{console.error("[ERROR] Al agregar tipo:",t)}})}enterTaskType(t){console.log("[NAVIGATE TO]",t),this.router.navigate(["/app/category",t.key])}openEditModal(t){this.taskTypeToEdit=t.key,this.editedTaskType=t.nombre,this.isEditModalOpen=!0}closeEditModal(){this.isEditModalOpen=!1,this.editedTaskType="",this.taskTypeToEdit=""}saveTaskTypeEdit(){this.editedTaskType.trim()&&this.taskTypeToEdit&&this.taskTypeService.editTaskType(this.taskTypeToEdit,this.editedTaskType).subscribe({next:()=>{this.loadTaskTypes(),this.closeEditModal()},error:t=>console.error("[ERROR] Al editar tipo:",t)})}openDeleteModal(t){this.taskTypeToDelete=t.key,this.isDeleteModalOpen=!0}closeDeleteModal(){this.taskTypeToDelete="",this.isDeleteModalOpen=!1}confirmDeleteTaskType(){this.taskTypeToDelete&&this.taskTypeService.deleteTaskType(this.taskTypeToDelete).subscribe({next:()=>{this.loadTaskTypes(),this.closeDeleteModal()},error:t=>console.error("[ERROR] Al eliminar tipo:",t)})}loadTodayTasks(){this.taskService.getAllTasks().subscribe({next:t=>{const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),s.getDate()),w=t.map(n=>{if("realizado"===n.estado)return n;if(n.fecha){const[c,T,p]=n.fecha.split("-").map(Number),m=new Date(c,T-1,p);n.estado=m.getTime()===o.getTime()?"para hoy":m.getTime()<o.getTime()?"no realizado":"pendiente"}else n.estado="pendiente";return n}).filter(n=>{const[c,T,p]=n.fecha?.split("-")?.map(Number)||[],m=new Date(c,T-1,p);return"no realizado"===n.estado||n.fecha&&m.getTime()===o.getTime()});this.todayTasks=w.sort((n,c)=>"no realizado"===n.estado&&"no realizado"!==c.estado?-1:"no realizado"===c.estado&&"no realizado"!==n.estado?1:0),this.todayTaskOrigins.clear(),this.todayTasks.forEach(n=>{if(n.tipo){const T=n.tipo.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ");this.todayTaskOrigins.set(n.nombre,T)}})},error:t=>console.error("[ERROR] Al cargar tareas:",t)})}changeTodayTaskStatus(t){const s=t.nombre.trim().toLowerCase().replace(/\s+/g,"_"),o=t.tipo;o&&this.taskService.updateTask(o,s,t).subscribe({next:()=>console.log("[UPDATE] Estado actualizado desde resumen"),error:a=>console.error("[ERROR] Al actualizar estado desde resumen:",a)})}getEstadoColor(t){switch(t.estado){case"realizado":return"bg-teal-600 text-white";case"para hoy":return"bg-orange-600 text-white";case"no realizado":return"bg-red-600 text-white";default:return"bg-slate-500 text-white"}}static{this.\u0275fac=function(s){return new(s||i)(e.rXU(g.z),e.rXU(k.R),e.rXU(b.k),e.rXU(y.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-home"]],standalone:!0,features:[e.aNF],decls:32,vars:6,consts:[[1,"p-6","w-full"],[1,"flex","flex-wrap","gap-4"],["class","bg-white rounded-lg shadow-md p-4 w-64 h-[160px] flex flex-col justify-between items-center dark:bg-slate-700",4,"ngFor","ngForOf"],[1,"bg-teal-600","hover:bg-teal-700","text-white","w-64","h-[160px]","rounded-lg","flex","items-center","justify-center","cursor-pointer","text-4xl",3,"click"],[1,"mt-10","w-full"],[1,"relative","flex","flex-col","bg-white","rounded-xl","shadow-lg","overflow-hidden","border","border-gray-200","dark:bg-slate-700","dark:border-gray-600"],[1,"flex","items-center","justify-between","p-6","bg-gradient-to-r","from-emerald-700","to-teal-700","text-white","rounded-t-xl","shadow-md"],[1,"text-xl","font-bold","tracking-wide"],[1,"text-sm","flex","items-center","gap-2","opacity-90"],[1,"text-base"],[1,"overflow-x-auto"],[1,"w-full","min-w-[640px]","border-collapse"],[1,"bg-gray-100"],[1,"border-b"],[1,"py-4","px-6","text-left","text-xs","font-semibold","uppercase","text-gray-600"],[1,"py-4","px-6","text-center","text-xs","font-semibold","uppercase","text-gray-600"],["class","border-b transition duration-300 hover:bg-gray-50",4,"ngFor","ngForOf"],[4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-40",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-md","p-4","w-64","h-[160px]","flex","flex-col","justify-between","items-center","dark:bg-slate-700"],[1,"text-lg","font-semibold"],[1,"flex","items-center","justify-between","w-full","gap-2"],[1,"bg-teal-600","text-white","py-1","px-3","rounded","hover:bg-teal-700","transition","flex-1",3,"click"],[1,"text-sky-700","text-xl",3,"click"],[1,"material-icons","text-sky-700"],[1,"text-orange-600","text-xl",3,"click"],[1,"material-icons","t","ext-orange-600"],[1,"border-b","transition","duration-300","hover:bg-gray-50"],[1,"py-4","px-6","font-bold","text-teal-800","dark:text-white"],[1,"py-4","px-6","font-semibold"],[1,"py-4","px-6","text-gray-700","dark:text-white"],[1,"py-4","px-6","text-center"],[1,"text-xs","font-semibold","px-3","py-1","rounded-full","shadow-sm","border",3,"ngModelChange","change","ngModel","ngClass"],["value","pendiente",1,"text-black","bg-slate-100"],["value","realizado",1,"text-black","bg-slate-100"],["value","no realizado",1,"text-black","bg-slate-100"],["value","para hoy",1,"text-black","bg-slate-100"],["colspan","4",1,"text-center","text-gray-500","py-6"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-40","z-40"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","mb-4"],[1,"block","mb-2"],["type","text",1,"w-full","p-2","border","rounded","mb-4",3,"ngModelChange","ngModel"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","border","rounded-md",3,"click"],[1,"px-4","py-2","bg-green-500","text-white","rounded-md",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-gray-900","bg-opacity-50","z-50"],[1,"text-gray-600","mb-4","text-sm"],[1,"block","mb-2","font-semibold"],["type","text","placeholder","Ej: Universidad",1,"w-full","p-2","border","rounded-md","mb-4",3,"ngModelChange","ngModel"],[1,"px-4","py-2","border","rounded-md","bg-white","hover:bg-slate-200",3,"click"],[1,"px-4","py-2","bg-sky-700","text-white","rounded-md","hover:bg-sky-800",3,"click"],[1,"bg-white","p-6","rounded-lg","shadow-lg","w-80","text-center"],[1,"material-icons","text-red-600","mx-auto","mb-4",2,"font-size","48px"],[1,"text-xl","font-bold","mt-4","mb-2"],[1,"mb-6","text-gray-700"],[1,"flex","justify-center","gap-2"],[1,"px-4","py-2","border","rounded-md","hover:bg-orange-200",3,"click"],[1,"px-4","py-2","bg-orange-600","text-white","rounded-md","hover:bg-red-600",3,"click"]],template:function(s,o){1&s&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,f,12,1,"div",2),e.j41(3,"div",3),e.bIt("click",function(){return o.openModal()}),e.EFF(4," + "),e.k0s()(),e.j41(5,"div",4)(6,"div",5)(7,"div",6)(8,"div")(9,"h6",7),e.EFF(10,"Resumen de Tareas"),e.k0s(),e.j41(11,"p",8)(12,"strong",9),e.EFF(13,"Solo las asignadas para hoy"),e.k0s()()()(),e.j41(14,"div",10)(15,"table",11)(16,"thead",12)(17,"tr",13)(18,"th",14),e.EFF(19,"Tipo"),e.k0s(),e.j41(20,"th",14),e.EFF(21,"Nombre"),e.k0s(),e.j41(22,"th",14),e.EFF(23,"Nota"),e.k0s(),e.j41(24,"th",15),e.EFF(25,"Estado"),e.k0s()()(),e.j41(26,"tbody"),e.DNE(27,x,17,5,"tr",16)(28,E,3,0,"tr",17),e.k0s()()()()()(),e.DNE(29,v,12,1,"div",18)(30,F,14,1,"div",19)(31,j,13,0,"div",19)),2&s&&(e.R7$(2),e.Y8G("ngForOf",o.taskTypes),e.R7$(25),e.Y8G("ngForOf",o.todayTasks),e.R7$(),e.Y8G("ngIf",0===o.todayTasks.length),e.R7$(),e.Y8G("ngIf",o.isModalOpen),e.R7$(),e.Y8G("ngIf",o.isEditModalOpen),e.R7$(),e.Y8G("ngIf",o.isDeleteModalOpen))},dependencies:[_.MD,_.YU,_.Sq,_.bT,l.YN,l.xH,l.y7,l.me,l.wz,l.BC,l.vS]})}}return i})()}}]);